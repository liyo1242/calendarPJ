"use strict";

function Calendar(id, size, labelSettings, colors, func) {
    this.id = id;
    this.size = size;
    this.labelSettings = labelSettings;
    this.colors = colors;
    this.initday = 0;
    func = func || {};
    this.indicator = !0;
    func.indicator != void 0 && (this.indicator = func.indicator);

    var li = document.createElement("LI");
    li.className = "list-placeholder";
    li.appendChild(document.createTextNode("No events on this day"));

    this.placeholder = li.outerHTML;
    func.placeholder != void 0 && (this.placeholder = func.placeholder);

    var month = ["1月", "2月", "3月", "4月", "5月", "6月", "7月", "8月", "9月", "10月", "11月", "12月"];
    func.months != void 0 && 12 == func.months.length && (month = func.months);

    var week = ["日", "一", "二", "三", "四", "五", "六"];
    func.days != void 0 && 7 == func.days.length && (week = func.days);

    this.months = month;
    this.label = [];
    this.labels = [];

    for (var l = 0; 7 > l; l++)
        this.label.push(week[week.indexOf(labelSettings[0]) + this.label.length >= week.length ? Math.abs(week.length - (week.indexOf(labelSettings[0]) + this.label.length)) : week.indexOf(labelSettings[0]) + this.label.length]);

    for (var l = 0; 7 > l; l++)
        this.labels.push(this.label[l]);

    this.date = new Date;
    this.today = new Date;
    this.draw();
    this.update();
    this.setOnClickListener("days-blocks");
    this.setOnClickListener("month-slider");
    this.setOnClickListener("year-slider");
}

Calendar.prototype = {
    constructor: Calendar,
    back: function(select) {
        var date = this.date,
            d = new Date(11 < date.getMonth() + 1 ? date.getFullYear() + 1 : date.getFullYear(), 12 < date.getMonth() + 1 ? 0 : date.getMonth() + 1, 0).getDate(),
            f = new Date(0 > date.getMonth() ? date.getFullYear() - 1 : date.getFullYear(), 0 > date.getMonth() ? 11 : date.getMonth(), 0).getDate();
        "month" == select ? (date.getDate() > f && this.changeDateTo(f), 0 < date.getMonth() ? date.setMonth(date.getMonth() - 1) : (date.setMonth(11), date.setFullYear(date.getFullYear() - 1))) : "year" == select && date.setFullYear(date.getFullYear() - 1), this.update()
    },
    next: function(select) {
        var date = this.date,
            d = new Date(11 < date.getMonth() + 1 ? date.getFullYear() + 1 : date.getFullYear(), 12 < date.getMonth() + 1 ? 0 : date.getMonth() + 1, 0).getDate(),
            f = new Date(11 < date.getMonth() + 2 ? date.getFullYear() + 1 : date.getFullYear(), 12 < date.getMonth() + 2 ? 0 : date.getMonth() + 2, 0).getDate();
        "month" == select ? (date.getDate() > f && this.changeDateTo(f), 11 == date.getMonth() ? (date.setMonth(0), date.setFullYear(date.getFullYear() + 1)) : date.setMonth(date.getMonth() + 1)) : date.setFullYear(date.getFullYear() + 1), this.update()
    },
    changeDateTo: function(select, c) {
        if (31 <= c && 11 >= select || 6 >= c && 8 <= select) {
            31 <= c && 11 >= select ? this.next("month") : 6 >= c && 8 <= select && this.back("month"), this.date.setDate(select);
            var d = this;
            return setTimeout(function() {
                d.update()
            }, 1), !0
        }
        this.date.setDate(select)
    }
},

Calendar.prototype.draw = function() {
    var a = "<svg style=\"width: 24px; height: 24px;\" viewBox=\"0 0 24 24\"><path fill=\"" + this.colors[3] + "\" d=\"M15.41,16.58L10.83,12L15.41,7.41L14,6L8,12L14,18L15.41,16.58Z\"></path></svg>",
        b = "<svg style=\"width: 24px; height: 24px;\" viewBox=\"0 0 24 24\"><path fill=\"" + this.colors[3] + "\" d=\"M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z\"></path></svg>",
        c = document.createElement("DIV");

    c.className = "calendar " + this.size, document.getElementById(this.id).appendChild(c.cloneNode(!0));
    for (var d = [], f = ["year", "month", "labels", "days"], g = 0; g < f.length; g++)
        if (d[g] = document.createElement("DIV"), d[g].className = f[g], "days" != f[g])
            if ("month" == f[g]) {
                d[g].style.backgroundColor = this.colors[0], d[g].style.color = this.colors[2];
                var h = document.createElement("DIV");
                h.id = this.id + "-month-back", h.insertAdjacentHTML("beforeend", a), d[g].appendChild(h.cloneNode(!0));
                var k = document.createElement("SPAN");
                k.id = this.id + "-" + f[g], d[g].appendChild(k.cloneNode(!0));
                var l = document.createElement("DIV");
                l.id = this.id + "-month-next", l.insertAdjacentHTML("beforeend", b), d[g].appendChild(l.cloneNode(!0))
            } else if (d[g].style.backgroundColor = this.colors[1], d[g].style.color = this.colors[3], "labels" != f[g]) {
                //var h = document.createElement("DIV");
                //h.id = this.id + "-year-back", h.insertAdjacentHTML("beforeend", a), d[g].appendChild(h.cloneNode(!0));
                var k = document.createElement("SPAN");
                k.id = this.id + "-" + f[g], d[g].appendChild(k.cloneNode(!0));
                //var l = document.createElement("DIV");
                //l.id = this.id + "-year-next", l.insertAdjacentHTML("beforeend", b), d[g].appendChild(l.cloneNode(!0))
            }

    for (var m, g = 0; g < this.labels.length; g++) m = document.createElement("SPAN"), m.id = this.id + "-label-" + (g + 1), m.appendChild(document.createTextNode(this.labels[g]).cloneNode(!0)), d[2].appendChild(m.cloneNode(!0));
    for (var n = [], o = [], p = [], g = 0; 6 > g; g++) n[g] = document.createElement("DIV"), n[g].className = "row";
    for (var g = 0, q = 0; 42 > g; g++) {
        p[g] = document.createElement("INPUT"), p[g].className = "day-radios", p[g].type = "radio", p[g].name = this.id + "-day-radios", p[g].id = this.id + "-day-radio-" + (g + 1), o[g] = document.createElement("LABEL"), o[g].className = "day", o[g].htmlFor = this.id + "-day-radio-" + (g + 1), o[g].id = this.id + "-day-" + (g + 1);
        var k = document.createElement("SPAN");
        k.id = this.id + "-day-num-" + (g + 1), o[g].appendChild(k.cloneNode(!0)), n[q].appendChild(p[g].cloneNode(!0)), n[q].appendChild(o[g].cloneNode(!0)), 0 == (g + 1) % 7 && q++
    }

    for (var g = 0; 6 > g; g++) d[3].appendChild(n[g].cloneNode(!0));
    //for (var g = 0; g < d.length; g++) c.appendChild(d[g].cloneNode(!0)); // class calendar append element
    //======= cut the year and month part
        var yearandmonth = document.createElement("DIV");
        yearandmonth.className =  "yearandmonth"
        yearandmonth.appendChild(d[0].cloneNode(!0)); // append year div
        yearandmonth.appendChild(d[1].cloneNode(!0)); // append month div
        // yearandmonth.setAttribute('type','button');
        // yearandmonth.setAttribute('data-toggle','dropdown');
        // yearandmonth.setAttribute('aria-haspopup','true');
        // yearandmonth.setAttribute('aria-expanded','false');
        c.appendChild(yearandmonth); // year and month
        c.appendChild(d[2].cloneNode(!0)); // labels
        c.appendChild(d[3].cloneNode(!0)); // days
    //======= cut
    document.getElementById(this.id).innerHTML = "<style>.day.active::before { background-color: " + this.colors[1] + ";opacity: 0.4; } .day.today > span { border-color: " + this.colors[1] + " !important; }</style>",
    document.getElementById(this.id).appendChild(c.cloneNode(!0))
},


Calendar.prototype.update = function() {

    document.getElementById(this.id + "-year").innerHTML = "", // year div inside word
    document.getElementById(this.id + "-month").innerHTML = this.date.getFullYear() + " " + this.months[this.date.getMonth()]; // month div inside word
    for (var a = 1; 42 >= a; a++) // Create class and initialize
        document.getElementById(this.id + "-day-num-" + a).innerHTML = "",
        document.getElementById(this.id + "-day-" + a).className = this.id + " day listed";

    var b = new Date(this.date.getFullYear(), // the first day in this monment
        this.date.getMonth(), 1).getDay(),
        c = new Date(11 < this.date.getMonth() + 1 ? this.date.getFullYear() + 1 : this.date.getFullYear(), // Judging more than December
            12 < this.date.getMonth() + 1 ? 0 : this.date.getMonth() + 1, 0).getDate(),
        d = new Date(0 > this.date.getMonth() ? this.date.getFullYear() - 1 : this.date.getFullYear(), 0 > this.date.getMonth() ? 11 : this.date.getMonth(), 0).getDate(); // Judging less than January
        this.initday = this.label.indexOf(this.label[b]); // first day place on this month

    for (var a = 0, f = d; a < this.label.indexOf(this.label[b]); a++, f--)  // a few days after the previous month
        document.getElementById(this.id + "-day-num-" + (this.label.indexOf(this.label[b]) - a)).innerHTML = f,
        document.getElementById(this.id + "-day-" + (this.label.indexOf(this.label[b]) - a)).className = this.id + " day diluted";

    for (var a = 1; a <= c; a++)  // the day draw on this month
    { //fuckyou
        document.getElementById(this.id + "-day-num-" + (this.label.indexOf(this.label[b]) + a)).innerHTML = a, // [this.date.getFullYear()][this.date.getMonth()][a]
        a == this.date.getDate() && (document.getElementById(this.id + "-day-radio-" + (this.label.indexOf(this.label[b]) + a)).checked = !0),
        this.date.getMonth() == this.today.getMonth() && a == this.today.getDate() && (document.getElementById(this.id + "-day-" + (this.label.indexOf(this.label[b]) + a)).className += " today");
    }
    for (var a = c + 1, f = 1; 42 >= this.label.indexOf(this.label[b]) + a; a++, f++) // A few days before the next month
        document.getElementById(this.id + "-day-num-" + (this.label.indexOf(this.label[b]) + a)).innerHTML = f,
        document.getElementById(this.id + "-day-" + (this.label.indexOf(this.label[b]) + a)).className = this.id + " day diluted"
},

Calendar.prototype.updateAllEvent = function(data){
    var eventData = data;
    var fuck = this.date;

    var warCriminal = document.querySelectorAll(".dayEvent");
    if(warCriminal.length != 0){
        for(var i = 0; i < warCriminal.length; i++){
            var child = warCriminal[i];
            child.parentNode.removeChild(child);
        }
    }

    var b = new Date(this.date.getFullYear(), // the first day in this monment
    this.date.getMonth(), 1).getDay();

    var c = new Date(11 < this.date.getMonth() + 1 ? this.date.getFullYear() + 1 : this.date.getFullYear(), // Judging more than December
                12 < this.date.getMonth() + 1 ? 0 : this.date.getMonth() + 1, 0).getDate()
    for (var a = 1; a <= c; a++)  // the day draw on this month
        { //fuckyou
            if(eventData[fuck.getFullYear()][fuck.getMonth() + 1 ] != undefined){
                var dayEventLine = eventData[fuck.getFullYear()][fuck.getMonth() + 1 ][a];

                if(dayEventLine != undefined){
                    for (var Roundtable = document.createElement("DIV"), cc = 0; cc < dayEventLine.length; cc++) {
                        Roundtable.className = "dayEvent";
                        var Knights = document.createElement("DIV");
                        Knights.id = dayEventLine[cc].id;
                        Knights.appendChild(document.createTextNode(dayEventLine[cc].text));
                        if(cc > 2){
                            console.log('fuck you get out');
                            Knights.style.display = "none";
                        }
                        Roundtable.appendChild(Knights);
                    }
                    if(Roundtable.childNodes.length > 3){
                        Roundtable.childNodes[2].style.display = "none";
                        var assassin = document.createElement("BUTTON");
                        assassin.className = "btn";
                        assassin.textContent = "還有" + (Roundtable.childNodes.length - 2) + "個";
                        Roundtable.appendChild(assassin);
                    }
                    document.getElementById(this.id + "-day-" + (this.label.indexOf(this.label[b]) + a)).appendChild(Roundtable);
                }
            }
        }
},

Calendar.prototype.setupBlock = function(a, b, c) {
    document.getElementById(b.id + "-day-" + a).onclick = function() {
        0 < document.getElementById(b.id + "-day-num-" + a).innerHTML.length && (b.changeDateTo(document.getElementById(b.id + "-day-num-" + a).innerHTML, a), c())
    }
},

Calendar.prototype.setOnClickListener = function(a, b, c) {
    var d = this.id;
    b = b || function() {}, c = c || function() {};
    var f = this;
    switch (a) {
        case "days-blocks":
            for (var g = 1; 42 >= g; g++) f.setupBlock(g, f, b);
            break;
        case "month-slider":
            document.getElementById(d + "-month-back").onclick = function() {
                f.back("month"), b()
            }, document.getElementById(d + "-month-next").onclick = function() {
                f.next("month"), c()
            };
            break;
        // case "year-slider":
        //     document.getElementById(d + "-year-back").onclick = function() {
        //         f.back("year"), b()
        //     }, document.getElementById(d + "-year-next").onclick = function() {
        //         f.next("year"), c()
        //     };
    }
};

function Organizer(a, b, c) {
    this.id = a,
    this.calendar = b,
    this.data = c || {},
    this.draw();
    var d = this;
    d.onMonthChange(function() {
        d.indicateEvents()
    }), this.setOnClickListener("days-blocks"), this.setOnClickListener("day-slider"), this.setOnClickListener("month-slider"), this.setOnClickListener("year-slider");
}
Organizer.prototype = {
    constructor: Organizer,
    back: function(b) {
        var c = this.calendar.date,
            d = new Date(11 < c.getMonth() + 1 ? c.getFullYear() + 1 : c.getFullYear(), 12 < c.getMonth() + 1 ? 0 : c.getMonth() + 1, 0).getDate(),
            f = new Date(0 > c.getMonth() ? c.getFullYear() - 1 : c.getFullYear(), 0 > c.getMonth() ? 11 : c.getMonth(), 0).getDate();
        if ("day" == b) {
            if (1 != c.getDate()) this.changeDateTo(c.getDate() - 1), this.update();
            else {
                this.calendar.back("month"), this.changeDateTo(d);
                var g = this;
                g.onMonthChange(function() {
                    g.indicateEvents()
                })
            }
            document.getElementById(this.calendar.id + "-day-radio-" + (this.calendar.initday + c.getDate())).checked = !0
        } else {
            this.calendar.back(b);
            var g = this;
            g.onMonthChange(function() {
                g.indicateEvents()
            })
        }
    },
    next: function(b) {
        var c = this.calendar.date,
            d = new Date(11 < c.getMonth() + 1 ? c.getFullYear() + 1 : c.getFullYear(), 12 < c.getMonth() + 1 ? 0 : c.getMonth() + 1, 0).getDate(),
            f = new Date(11 < c.getMonth() + 2 ? c.getFullYear() + 1 : c.getFullYear(), 12 < c.getMonth() + 2 ? 0 : c.getMonth() + 2, 0).getDate();
        if ("day" == b) {
            if (c.getDate() != d) c.setDate(c.getDate() + 1), this.update();
            else {
                this.calendar.next("month"), c.setDate(1);
                var g = this;
                g.onMonthChange(function() {
                    g.indicateEvents()
                })
            }
            document.getElementById(this.calendar.id + "-day-radio-" + (this.calendar.initday + c.getDate())).checked = !0
        } else {
            this.calendar.next(b);
            var g = this;
            g.onMonthChange(function() {
                g.indicateEvents()
            })
        }
    },
    changeDateTo: function(b, c) {
        var d = this.calendar.changeDateTo(b, c),
            f = this;
        setTimeout(function() {
            d ? f.onMonthChange(function() {
                f.indicateEvents()
            }) : f.update()
        }, 1)
    }
}, Organizer.prototype.draw = function() {
    var a = "<svg style=\"width: 24px; height: 24px;\" viewBox=\"0 0 24 24\"><path fill=\"" + this.calendar.colors[3] + "\" d=\"M15.41,16.58L10.83,12L15.41,7.41L14,6L8,12L14,18L15.41,16.58Z\"></path></svg>",
        b = "<svg style=\"width: 24px; height: 24px;\" viewBox=\"0 0 24 24\"><path fill=\"" + this.calendar.colors[3] + "\" d=\"M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z\"></path></svg>",
        c = document.createElement("DIV");
    c.className = "events " + this.calendar.size;
    var d = document.createElement("DIV");
    d.className = "date", d.style.backgroundColor = this.calendar.colors[1], d.style.color = this.calendar.colors[3];
    var f = document.createElement("DIV");
    f.id = this.id + "-day-back", f.insertAdjacentHTML("beforeend", a), d.appendChild(f.cloneNode(!0));
    var g = document.createElement("SPAN");
    g.id = this.id + "-date", d.appendChild(g.cloneNode(!0));
    var h = document.createElement("DIV");
    h.id = this.id + "-day-next", h.insertAdjacentHTML("beforeend", b), d.appendChild(h.cloneNode(!0));
    var k = document.createElement("DIV");
    k.className = "rows";
    var l = document.createElement("OL");
    l.className = "list example item-list"/* item-list example */, l.id = this.id + "-list", k.appendChild(l.cloneNode(!0)), c.appendChild(d.cloneNode(!0)), c.appendChild(k.cloneNode(!0)), document.getElementById(this.id).appendChild(c.cloneNode(!0));

},

Organizer.prototype.update = function() {

    document.getElementById(this.id + "-date").innerHTML = this.calendar.months[this.calendar.date.getMonth()] + " " + this.calendar.date.getDate() + ", " + this.calendar.date.getFullYear(), document.getElementById(this.id + "-list").innerHTML = "", this.showEvents()
},

Organizer.prototype.list = function(a) {
    document.getElementById(this.id + "-list").innerHTML = "";
    for (var d, b = document.createElement("UL"), c = 0; c < a.length; c++) {
        d = document.createElement("LI"),d.className = "item" ; d.id = this.id + "-list-item-" + c;
        var f = document.createElement("DIV"),
            g = document.createElement("SPAN");
        g.id = this.id + "-list-item-" + c + "-time", g.class = this.id + " time", g.appendChild(document.createTextNode(a[c].startTime + " - " + a[c].endTime)), f.appendChild(g);
        var h = document.createElement("P");
        h.setAttribute('data-target','#exampleModal');
        h.setAttribute('data-toggle','modal');
        var sendData = {
            id: a[c].id,
            text: a[c].text
        }
        h.setAttribute("data-whatever",JSON.stringify(sendData));
        h.id = this.id + "-list-item-" + c + "-text";


        var dbtn = document.createElement("BUTTON");

        dbtn.className = "action-d" , dbtn.id = "delete-" + a[c].id ;
        //========================================
        dbtn.onclick = function(event){
            console.log(event);
        }

        // $(document).on("click", '.mylink', function(event) { 
        //     alert("new link clicked!");
        // });

        //========================================
        var ubtn = document.createElement("BUTTON");

        ubtn.className = "action-u" , ubtn.id = "update-" + a[c].id;

        ubtn.onclick = function(event){
            console.log(event);
        }

        h.appendChild(document.createTextNode(a[c].text)),dbtn.appendChild(document.createTextNode("delete")),ubtn.appendChild(document.createTextNode("update")), d.appendChild(ubtn) ,d.appendChild(f), d.appendChild(h), d.appendChild(dbtn) , b.appendChild(d);
    }
    document.getElementById(this.id + "-list").innerHTML = b.innerHTML, 0 == a.length && this.showPlaceholder()
    $('.example').listSwipe();
},

Organizer.prototype.setupBlock = function(a, b, c) {
    var d = b.calendar;
    document.getElementById(d.id + "-day-" + a).onclick = function() {
        var $body = (window.opera) ? (document.compatMode == 'CSS1Compat' ? $('html') : $('body')) : $('html,body');
        $body.animate({
            scrollTop: $('#organizerContainer').offset().top
        }, 1000);
        0 < document.getElementById(d.id + "-day-num-" + a).innerHTML.length && (b.changeDateTo(document.getElementById(d.id + "-day-num-" + a).innerHTML, a), c())
    };
},

Organizer.prototype.showEvents = function(a) {
    a = a || this.data;
    var b = this.calendar.date;
    try {
        this.list(a[b.getFullYear()][b.getMonth() + 1][b.getDate()])
    } catch (c) {
        this.showPlaceholder()
    }
},

Organizer.prototype.showPlaceholder = function() {
    document.getElementById(this.id + "-list").innerHTML = this.calendar.placeholder
},

Organizer.prototype.indicateEvents = function(a) {
    this.calendar.updateAllEvent(this.data);
    console.log("there is");
    a = a || this.data;
    var b = this.calendar.date;
    if (this.calendar.indicator) {
        var c = document.getElementsByClassName(this.calendar.id + " day listed");
        try {
            var d = a[b.getFullYear()][b.getMonth() + 1];
            for (var f in d) 0 < d[f].length && (c[f - 1].className += " active")
        } catch (g) {}
    }
    this.update()
},

Organizer.prototype.onMonthChange = function(a) {
    a()
},

Organizer.prototype.setOnClickListener = function(a, b, c) {
    var d = this.calendar.id,
        f = this.id;
    b = b || function() {}, c = c || function() {};
    var g = this;
    switch (a) {
        case "days-blocks":
            for (var h = 1; 42 >= h; h++) g.setupBlock(h, g, b);
            break;
        case "day-slider":
            document.getElementById(f + "-day-back").onclick = function() {
                g.back("day"), b()
            }, document.getElementById(f + "-day-next").onclick = function() {
                g.next("day"), c()
            };
            break;
        case "month-slider":
            document.getElementById(d + "-month-back").onclick = function() {
                g.back("month"), b()
            }, document.getElementById(d + "-month-next").onclick = function() {
                g.next("month"), c()
            };
            break;
        // case "year-slider":
        //     document.getElementById(d + "-year-back").onclick = function() {
        //         g.back("year"), b()
        //     }, document.getElementById(d + "-year-next").onclick = function() {
        //         g.next("year"), c()
        //     };
    }
};